#encoding:utf-8
#==============================================================================
# ■ Sprite_SongList
#------------------------------------------------------------------------------
#  显示歌曲列表信息的精灵。
#==============================================================================

class Sprite_SongList < Sprite
  #--------------------------------------------------------------------------
  # ● 常量
  #--------------------------------------------------------------------------
  FONT = Font.new('微软雅黑', 15)
  LINE_HEIGHT = 30
  #--------------------------------------------------------------------------
  # ● 初始化对象
  #--------------------------------------------------------------------------
  def initialize(_)
    super
    self.bitmap = Bitmap.new(Graphics.width, Graphics.height)
    bitmap.font = FONT
    refresh
  end
  #--------------------------------------------------------------------------
  # ● 更新
  #--------------------------------------------------------------------------
  def update
    refresh unless @header.equal?(header)
  end
  #--------------------------------------------------------------------------
  private
  #--------------------------------------------------------------------------
  # ● 获取场景的歌曲头文件
  #--------------------------------------------------------------------------
  def header(offset = 0)
    Scene.scene.header(offset)
  end
  #--------------------------------------------------------------------------
  # ● 刷新
  #--------------------------------------------------------------------------
  def refresh
    @header = header
    bitmap.clear
    draw_up
    draw_current
    draw_down
  end
  #--------------------------------------------------------------------------
  # ● 绘制简单的歌曲信息
  #--------------------------------------------------------------------------
  def draw_simple_info(header, x, y, width = 340, height = LINE_HEIGHT)
    bitmap.draw_text(x, y, width, height, header.title)
    bitmap.draw_text(x, y, width, height, "★#{header.level}", 2)
  end
  #--------------------------------------------------------------------------
  # ● 绘制上方的歌曲信息
  #--------------------------------------------------------------------------
  def draw_up
    (-3).upto(-1) do |i|
      draw_simple_info(header(i), 60, 105 + i * LINE_HEIGHT)
    end
  end
  #--------------------------------------------------------------------------
  # ● 绘制下方的歌曲信息
  #--------------------------------------------------------------------------
  def draw_down
    1.upto(3) do |i|
      draw_simple_info(header(i), 60, 125 + i * LINE_HEIGHT)
    end
  end
  #--------------------------------------------------------------------------
  # ● 绘制选中的歌曲信息
  #--------------------------------------------------------------------------
  def draw_current
    draw_simple_info(@header, 120, 110, 340)
    #TODO: 绘制全连的皇冠，当前分数等信息
    # playdata = Taiko.load(@header.name)
    # if playdata  # 有记录成绩
    #   if playdata[:miss] == 0
    #     画金冠
    #   elsif playdata[:normal_clear]
    #     画银冠
    #   end
    #   绘制 playdata[:score]
    # end
  end
end